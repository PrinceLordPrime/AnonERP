/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package DynamicERP.frames.voucher;

import DB.PAK_VOUCHR_DB;
import java.sql.Connection;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.ComboBoxModel;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JComboBox;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JTextField;

/**
 *
 * @author Shan
 */
public class PakVocFieldsPanel extends javax.swing.JPanel {

    /**
     * Creates new form PakVocFieldsPanel
     */
    public PakVocFieldsPanel() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel2 = new javax.swing.JLabel();
        seqno = new javax.swing.JTextField();
        financeCode = new javax.swing.JTextField();
        financeName = new javax.swing.JComboBox();
        amount = new javax.swing.JTextField();
        type = new javax.swing.JComboBox();

        setPreferredSize(new java.awt.Dimension(615, 21));

        jLabel2.setFont(new java.awt.Font("Times New Roman", 1, 12)); // NOI18N
        jLabel2.setForeground(new java.awt.Color(255, 255, 255));
        jLabel2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/oracledms/frames/resources/db_rem1.png"))); // NOI18N

        seqno.setEditable(false);
        seqno.setText("0");

        financeCode.setText("0");
        financeCode.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                financeCodeKeyReleased(evt);
            }
        });

        financeName.setFont(new java.awt.Font("Calibri", 1, 11)); // NOI18N
        financeName.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "supp OR finance ", "Others" }));
        financeName.addPopupMenuListener(new javax.swing.event.PopupMenuListener() {
            public void popupMenuCanceled(javax.swing.event.PopupMenuEvent evt) {
            }
            public void popupMenuWillBecomeInvisible(javax.swing.event.PopupMenuEvent evt) {
            }
            public void popupMenuWillBecomeVisible(javax.swing.event.PopupMenuEvent evt) {
                financeNamePopupMenuWillBecomeVisible(evt);
            }
        });
        financeName.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                financeNameActionPerformed(evt);
            }
        });

        amount.setText("0.0");

        type.setFont(new java.awt.Font("Times New Roman", 0, 11)); // NOI18N
        type.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Debit", "Credit" }));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 16, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(seqno, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(financeCode, javax.swing.GroupLayout.PREFERRED_SIZE, 98, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(financeName, 0, 302, Short.MAX_VALUE)
                .addGap(0, 0, 0)
                .addComponent(type, javax.swing.GroupLayout.PREFERRED_SIZE, 67, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addComponent(amount, javax.swing.GroupLayout.PREFERRED_SIZE, 86, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                .addComponent(seqno, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(financeCode, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(financeName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(amount, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(type, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void financeNamePopupMenuWillBecomeVisible(javax.swing.event.PopupMenuEvent evt) {//GEN-FIRST:event_financeNamePopupMenuWillBecomeVisible
        PAK_VOUCHR_DB data =new PAK_VOUCHR_DB();
        Connection conn;
        try {
            conn = data.connect_database();
            financeName.setModel(buildAllComboBoxModel());
            //            if(setSelectedComboItem(financeCode,financeName,((!financeCode.getText().isEmpty())?data.find_supp_name_by_code(conn, financeCode.getText()):""))){
                if(setSelectedComboItem(financeCode,financeName,((!financeCode.getText().isEmpty())?data.find_product_name_by_code(conn, financeCode.getText()):""))){

                }else{
                    financeCode.setText(getCode(financeName.getSelectedItem().toString()));
                    
                    //===================================
//                    frmGrossAmount();
//                    frmNetAmount();
                }
                conn.close();
            } catch (SQLException ex) {
                Logger.getLogger(VOUCHERS.class.getName()).log(Level.SEVERE, null, ex);
            } catch (Exception ex) {
                Logger.getLogger(VOUCHERS.class.getName()).log(Level.SEVERE, null, ex);
            }
    }//GEN-LAST:event_financeNamePopupMenuWillBecomeVisible

    private void financeNameActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_financeNameActionPerformed
//        System.out.println("seek.getText():"+financeCode.getText()+" :<=|--|=>: getCode(financeName.getSelectedItem().toString()):"+getCode(financeName.getSelectedItem().toString()));
        if(financeCode.getText().equals(getCode(financeName.getSelectedItem().toString()))){
            //            System.out.println("M");
        }else{
            financeCode.setText(getCode(financeName.getSelectedItem().toString()));
            //            System.out.println("Not M");
        }
//        setAllFieldData();
    }//GEN-LAST:event_financeNameActionPerformed

    private void financeCodeKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_financeCodeKeyReleased
        try {
            updateComboBox(financeCode, financeName);
        } catch (Exception ex) {
            Logger.getLogger(VOUCHERS.class.getName()).log(Level.SEVERE, null, ex);
        }
//        setAllFieldData();
    }//GEN-LAST:event_financeCodeKeyReleased

    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField amount;
    private javax.swing.JTextField financeCode;
    private javax.swing.JComboBox financeName;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JTextField seqno;
    private javax.swing.JComboBox type;
    // End of variables declaration//GEN-END:variables

    public JComboBox getType() {
        return type;
    }

    public void setType(JComboBox type) {
        this.type = type;
    }

    public JLabel getjLabel2() {
        return jLabel2;
    }

    public void setjLabel2(JLabel jLabel2) {
        this.jLabel2 = jLabel2;
    }

    public JTextField getAmount() {
        return amount;
    }

    public void setAmount(JTextField amount) {
        this.amount = amount;
    }

    public JTextField getFinanceCode() {
        return financeCode;
    }

    public void setFinanceCode(JTextField financeCode) {
        this.financeCode = financeCode;
    }

    public JComboBox getFinanceName() {
        return financeName;
    }

    public void setFinanceName(String finance) {
        try {
                financeName.setModel(buildOneComboBoxModel(finance));
            } catch (Exception ex) {
                Logger.getLogger(VOUCHERS.class.getName()).log(Level.SEVERE, null, ex);
            }
    }

    public JTextField getSeqno() {
        return seqno;
    }

    public void setSeqno(JTextField seqno) {
        this.seqno = seqno;
    }
    
    
    public void textFieldsEditableProducts(boolean b) {
        seqno.setEditable(false);
        financeCode.setEditable(b);
        financeName.setEnabled(b);
        type.setEnabled(b);
        amount.setEditable(b);
        jLabel2.setEnabled(b);
        
    }

     private String getCode(String name) {
        String s="";
         PAK_VOUCHR_DB data =new PAK_VOUCHR_DB();
        Connection conn;
        try {
            conn = data.connect_database();
            if(!name.equals("")){
                s=data.find_product_code_by_name(conn,name);
            }else{
//                JFrame j=new JFrame();
//                j.setAlwaysOnTop(true);
//                JOptionPane.showMessageDialog(j, "Emter Id Found");
            }       
            data.close_database(conn);
        } catch (SQLException ex) {
            Logger.getLogger(VOUCHERS.class.getName()).log(Level.SEVERE, null, ex);
        }
        return s;
    }
     public boolean setSelectedComboItem(JTextField textField,JComboBox comboBox, String value)
    {
        boolean tf=false;
        String item;
        if(value!=null){
            for (int i = 0; i < comboBox.getItemCount(); i++)
            {
                item = (String)comboBox.getItemAt(i);
                System.out.println("item:"+item);
                if (!item.isEmpty())
                {
                    if (item.equals(value))
                    {
                        comboBox.setSelectedIndex(i);
                        tf=true;
                        break;
                    }
                }else{
                    System.out.println(">== Message: Item is empty. . . ");
                    JFrame j=new JFrame();
                    j.setAlwaysOnTop(true);
                    JOptionPane.showMessageDialog(j, "First Add Items in : "+comboBox.getName(), "InfoBox: ", JOptionPane.INFORMATION_MESSAGE);
                }
            }   
        }else{
            System.out.println(">== Message: Value could not be  Selected . . . ");
            comboBox.setSelectedIndex(0);
        }
        return tf;
    }
    public static DefaultComboBoxModel buildAllComboBoxModel() throws Exception {
        DefaultComboBoxModel comboBoxModel = new DefaultComboBoxModel();
        PAK_VOUCHR_DB data =new PAK_VOUCHR_DB();
        Connection conn;
        ArrayList<String> elements = new <String> ArrayList() ;
        try {
            conn = data.connect_database();
            boolean tf=false;
            elements=data.find_all_product_name_size_by_code(conn);
            if(elements!=null){    
                for(String s : elements){
                    comboBoxModel.addElement(s);
                }
            }else{
                JFrame j=new JFrame();
                    j.setAlwaysOnTop(true);
                    JOptionPane.showMessageDialog(j, "Not Edited", "InfoBox: ", JOptionPane.INFORMATION_MESSAGE);
            }
            System.out.println("Is Inserted :"+ tf);
            data.close_database(conn);
        } catch (SQLException ex) {
            Logger.getLogger(VOUCHERS.class.getName()).log(Level.SEVERE, null, ex);
        }
        return comboBoxModel;
    }

    private void updateComboBox(JTextField textField,JComboBox comboBox) throws Exception {
        comboBox.setModel(buildOneComboBoxModel(textField.getText()));
    }

    public DefaultComboBoxModel buildOneComboBoxModel(String id) throws Exception {
        DefaultComboBoxModel comboBoxModel = new DefaultComboBoxModel();
        PAK_VOUCHR_DB data =new PAK_VOUCHR_DB();
        Connection conn;
        String element = "";
        conn = data.connect_database();
        String temp;
        if(!id.equals("")){
            temp=data.find_product_rec_by_code(conn, id);
            String s2 =null;
            if(temp!=null){
                element=temp;
                comboBoxModel.addElement(element);
            }
        }
        return comboBoxModel;
    }

}
